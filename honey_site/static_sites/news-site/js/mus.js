/*!
 * Mus.js v1.1.0
 * (c) 2018 Mauricio Giordano <giordano@inevent.us> - InEvent
 * Released under the MIT License.
 */ !function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Mus=e()}(this,function(){"use strict";function t(){if(void 0===this){console.error('Have you initialized Mus with "new" statement? (i.e. var mus = new Mus())');return}this.frames=[],this.timeouts=[],this.pos=0,this.currPos=0,this.startedAt=0,this.finishedAt=0,this.timePoint=!1,this.recording=!1,this.playing=!1,this.playbackSpeed=this.speed.NORMAL,this.observer="",this.window={width:window.outerWidth,height:window.outerHeight},this.onmousemove=window.onmousemove,this.onmousedown=window.onmousedown,this.onscroll=window.onscroll,this.inputWithUserKeyEvent=()=>{document.querySelectorAll("textarea, input[type=text], input[type=email], input[type=number], input[type=password], input[type=tel], input[type=search], input[type=url], input[type=search], input[type=week], input[type=month], input[type=datetime-local]").forEach(t=>{t.onkeydown=null})},this.inputWithOnchangeEvent=()=>{document.querySelectorAll("select, input[type=checkbox], input[type=radio], input[type=color], input[type=date], input[type=file], input[type=number], input[type=range], input[type=time]").forEach(t=>{t.onchange=null})}}return t.prototype={moveListener:function(t){return function(e){t&&t(["m",e.clientX,e.clientY])}},clickListener:function(t){return function(e){t&&t(["c",e.clientX,e.clientY])}},scrollListener:function(t){return function(e){t&&t(["s",document.scrollingElement.scrollLeft,document.scrollingElement.scrollTop])}},inputWithUserKeyListener:function(t){var e=this;return function(i){console.log(i),t&&t(["i",e.getXpathFromElement(i.target),i.target.value])}},inputWithOnchangeListener:function(t){var e=this;return function(i){t&&t(["o",e.getXpathFromElement(i.target),i.target.value])}},mutationObserver:function(t){return function(e){t&&t(e)}},record:function(t){if(this.recording)return;var e=this;0==e.startedAt&&(e.startedAt=new Date().getTime()/1e3),e.timePoint?e.frames.push(["s",document.scrollingElement.scrollLeft,document.scrollingElement.scrollTop,0]):e.frames.push(["s",document.scrollingElement.scrollLeft,document.scrollingElement.scrollTop]),document.querySelectorAll("textarea, input[type=text], input[type=email], input[type=number], input[type=password], input[type=tel], input[type=search], input[type=url], input[type=search], input[type=week], input[type=month], input[type=datetime-local]").forEach(t=>{e.timePoint?e.frames.push(["i",e.getXpathFromElement(t),t.value,0]):e.frames.push(["i",e.getXpathFromElement(t),t.value])}),document.querySelectorAll("select, input[type=checkbox], input[type=radio], input[type=color], input[type=date], input[type=file], input[type=number], input[type=range], input[type=time]").forEach(t=>{e.timePoint?"checkbox"==t.type||"radio"==t.type?e.frames.push(["o",e.getXpathFromElement(t),t.value,t.checked,0]):e.frames.push(["o",e.getXpathFromElement(t),t.value,0]):"checkbox"==t.type||"radio"==t.type?e.frames.push(["o",e.getXpathFromElement(t),t.value,t.checked]):e.frames.push(["o",e.getXpathFromElement(t),t.value])}),window.onmousemove=this.moveListener(function(i){e.frames.push(e.timePoint?i.concat(new Date().getTime()-1e3*e.startedAt):i),t instanceof Function&&t()}),window.onmousedown=this.clickListener(function(i){e.frames.push(e.timePoint?i.concat(new Date().getTime()-1e3*e.startedAt):i),t instanceof Function&&t()}),window.onscroll=this.scrollListener(function(i){e.frames.push(e.timePoint?i.concat(new Date().getTime()-1e3*e.startedAt):i),t instanceof Function&&t()}),document.querySelectorAll("textarea, input[type=text], input[type=email], input[type=number], input[type=password], input[type=tel], input[type=search], input[type=url], input[type=search], input[type=week], input[type=month], input[type=datetime-local]").forEach(i=>{i.oninput=this.inputWithUserKeyListener(function(i){console.log(i),e.frames.push(e.timePoint?i.concat(new Date().getTime()-1e3*e.startedAt):i),t instanceof Function&&t()})}),document.querySelectorAll("select, input[type=checkbox], input[type=radio], input[type=color], input[type=date], input[type=file], input[type=number], input[type=range], input[type=time]").forEach(i=>{i.onchange=this.inputWithOnchangeListener(function(i){let n=e.getElementByXpath(i[1]);("checkbox"==n.type||"radio"==n.type)&&(i=i.concat(n.checked)),e.frames.push(e.timePoint?i.concat(new Date().getTime()-1e3*e.startedAt):i),t instanceof Function&&t()})});let i=document.querySelector("body");var n=window.MutationObserver||window.WebKitMutationObserver;this.observer=new n(this.mutationObserver(function(i){for(let n of i)if("attributes"==n.type){var o=[];o=n.target.hasAttribute(n.attributeName)?["a",e.getXpathFromElement(n.target),n.attributeName,n.target.getAttribute(n.attributeName),n.oldValue,"M"]:["a",e.getXpathFromElement(n.target),n.attributeName,n.oldValue,"D"],e.frames.push(e.timePoint?o.concat(new Date().getTime()-1e3*e.startedAt):o),t instanceof Function&&t()}})),this.observer.observe(i,{attributes:!0,attributeOldValue:!0,subtree:!0}),e.recording=!0},stop:function(){this.finishedAt=new Date().getTime()/1e3,window.onmousemove=this.onmousemove,window.onmousedown=this.onmousedown,window.onscroll=this.onscroll,this.inputWithUserKeyEvent(),this.inputWithOnchangeEvent(),""!=this.observer&&this.observer.disconnect(),this.timeouts=[],this.recording=!1,this.playing=!1,this.pos=0},pause:function(){this.playing&&(this.pos=this.currPos,this.playing=!1,this.clearTimeouts())},play:function(t){if(!this.playing){var e=this;e.createCursor();for(var i=document.getElementById("musCursor"),n="";e.pos<e.frames.length;e.pos++)n=e.timePoint?e.frames[e.pos][e.frames[e.pos].length-1]:e.pos*e.playbackSpeed,e.timeouts.push(setTimeout(function(n){e.playFrame(e,e.frames[n],i),e.currPos=n,n==e.frames.length-1&&(i.style.backgroundColor="transparent",e.timeouts=[],e.playing=!1,e.pos=0,t&&t())},n,e.pos));this.playing=!0}},release:function(){this.frames=[],this.startedAt=0,this.finishedAt=0,this.stop(),this.destroyCursor(),this.destroyClickSnapshot()},playFrame:function(t,e,i){if("m"==e[0])i.style.left=t.getXCoordinate(e[1])+"px",i.style.top=t.getYCoordinate(e[2])+"px";else if("c"==e[0])t.createClickSnapshot(e[2],e[1]);else if("s"==e[0])window.scrollTo(e[1],e[2]);else if("i"==e[0])t.getElementByXpath(e[1]).value=e[2];else if("o"==e[0]){let n=t.getElementByXpath(e[1]);"checkbox"==n.type||"radio"==n.type?n.checked=e[3]:n.value=e[2]}else if("a"==e[0]){let o=t.getElementByXpath(e[1]);"M"==e[5]?o.setAttribute(e[2],e[3]):"D"==e[4]&&o.removeAttribute(e[2])}},clearTimeouts:function(){for(var t in this.timeouts)clearTimeout(this.timeouts[t]);this.timeouts=[]},timeElapsed:function(){return this.finishedAt-this.startedAt},createCursor:function(){if(!document.getElementById("musCursor")){var t=document.createElement("div");t.id="musCursor",t.style.position="fixed",t.style.width="32px",t.style.height="32px",t.style.top="-100%",t.style.left="-100%",t.style.borderRadius="32px",t.style.backgroundImage="url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiCSB2aWV3Qm94PSIwIDAgMjggMjgiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI4IDI4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cG9seWdvbiBmaWxsPSIjRkZGRkZGIiBwb2ludHM9IjguMiwyMC45IDguMiw0LjkgMTkuOCwxNi41IDEzLDE2LjUgMTIuNiwxNi42ICIvPjxwb2x5Z29uIGZpbGw9IiNGRkZGRkYiIHBvaW50cz0iMTcuMywyMS42IDEzLjcsMjMuMSA5LDEyIDEyLjcsMTAuNSAiLz48cmVjdCB4PSIxMi41IiB5PSIxMy42IiB0cmFuc2Zvcm09Im1hdHJpeCgwLjkyMjEgLTAuMzg3MSAwLjM4NzEgMC45MjIxIC01Ljc2MDUgNi41OTA5KSIgd2lkdGg9IjIiIGhlaWdodD0iOCIvPjxwb2x5Z29uIHBvaW50cz0iOS4yLDcuMyA5LjIsMTguNSAxMi4yLDE1LjYgMTIuNiwxNS41IDE3LjQsMTUuNSAiLz48L3N2Zz4=)",document.body.appendChild(t)}},destroyCursor:function(){var t=document.getElementById("musCursor");t&&t.remove()},createClickSnapshot:function(t,e){var i=document.scrollingElement.scrollLeft,n=document.scrollingElement.scrollTop,o=document.createElement("div");o.className="musClickSnapshot",o.style.position="absolute",o.style.width="32px",o.style.height="32px",o.style.top=t+n+"px",o.style.left=e+i+"px",o.style.borderRadius="32px",o.style.backgroundColor="red",o.style.opacity=.2,document.body.appendChild(o)},destroyClickSnapshot:function(){for(var t=document.getElementsByClassName("musClickSnapshot");t.length>0;)t[0].remove()},getXCoordinate:function(t){return window.outerWidth>this.window.width?parseInt(this.window.width*t/window.outerWidth):parseInt(window.outerWidth*t/this.window.width)},getYCoordinate:function(t){return window.outerHeight>this.window.height?parseInt(this.window.height*t/window.outerHeight):parseInt(window.outerHeight*t/this.window.height)},getData:function(){return{frames:this.frames,timeElapsed:this.timeElapsed(),window:{width:window.outerWidth,height:window.outerHeight}}},isTimePoint:function(){return this.timePoint},setData:function(t){t.frames&&(this.frames=t.frames),t.window&&(this.window=t.window)},setFrames:function(t){this.frames=t},setWindowSize:function(t,e){this.window.width=t,this.window.height=e},setPlaybackSpeed:function(t){this.playbackSpeed=t},setTimePoint:function(t){this.timePoint=t},isRecording:function(){return this.recording},isPlaying:function(){return this.playing},speed:{SLOW:35,NORMAL:15,FAST:5},getXpathFromElement:function(t){document.getElementsByTagName("*");for(var e=[];t&&1==t.nodeType;t=t.parentNode){for(var i=1,n=t.previousSibling;n;n=n.previousSibling)n.localName==t.localName&&i++;e.unshift(t.localName.toLowerCase()+"["+i+"]")}return e.length?"/"+e.join("/"):null},getElementByXpath:function(t){return new XPathEvaluator().evaluate(t,document.documentElement,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}},t});
